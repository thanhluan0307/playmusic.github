var songs = [
    {
        name : 'Bà Năm',
        image : 'image/Phi_nhung.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/ba_nam.mp3',
        
      },
      {
        name : 'Gọi đò',
        image : 'image/ngoc_thai.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/goi_do_duong_ngoc_thai_7859612965389526044.mp3',
       
    },
    {
        name : 'Gửi về quan họ',
        image : 'image/hong_loan.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/gui_ve_quan_ho_duy_phuong_a_dam_giong_ca_qua_dinh_-652226894167376623.mp3',
     
    },
    {
        name : 'Mưa chiều miền trung',
        image : 'image/hong_loan1.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/mua_chieu_mien_trung_duong_hong_loan_official_mv_hgeOB3MByoK-gucZSHIB.mp3',
       
    },
    {
        name : 'Hạ Thương',
        image : 'image/ngoc_son.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/ngoc_son_ha_thuong_1984828350399727955.mp3',
    
    }, 
    {
        name : 'Quảng bình quê ta',
        image : 'image/Linkin_park.jfif',
        singer: "Raftaar x Fortnite",
        path : 'songs/quang_binh_que_ta_hd_3412967577559774427.mp3',
      
    }, 
    {
        name : 'Tìn em biển rộng sóng dài',
        image : 'image/quan_binh_que_ta.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/tinh_em_bien_rong_song_dai_rot_mat_tu_cau_dau_tien_-1668725769454382275.mp3',
      
    },
    {
        name : 'Đỗ Thanh Long ',
        image : 'image/ong_long.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/vam_co_dong_quoc_dai_1833034.mp3',
    
    },
    {
        name : 'Nguyễn Thị Tám',
        image : 'image/ba_tam.jpg',
        singer: "Raftaar x Fortnite",
        path : 'songs/xin_em_dung_khoc_vu_quy_-1520363635554719921.mp3',
    
    }
]
var textMaroon5 = [
  {start: '0.661', text: 'Song: Sugar'} ,
  {start: '2.661', text: 'Singer: Maroon 5'} ,
  {start: '8.731', text: "I'm hurting, baby,"} ,
  {start: '10.391', text: "I'm broken down"} ,
  {start: '12.651', text: 'I need your loving, loving,'} ,
  {start: '14.701', text: 'I need it now'} ,
  {start: '16.611', text: "When I'm without you"} ,
  {start: '18.581', text: "I'm something weak"} ,
  {start: '20.691', text: 'You got me begging'},
  {start: '22.151', text: "Begging, I'm on my knees"}, 
  {start: '24.621', text: "I don't wanna be needing your love"}, 
  {start: '26.601', text: 'I just wanna be deep in your love'}, 
  {start: '28.551', text: "And it's killing me when you're away"}, 
  {start: '31.621', text: 'Ooh, baby,'}, 
  {start: '32.701', text: "'Cause I really don't care where you are"}, 
  {start: '34.581', text: 'I just wanna be there where you are'}, 
  {start: '36.601', text: 'And I gotta get one little taste'}, 
  {start: '39.781', text: 'Your sugar'}, 
  {start: '41.781', text: 'Yes, please'}, 
  {start: '43.741', text: "Won't you come and put it down on me"}, 
  {start: '47.671', text: "I'm right here,"}, 
  {start: '49.651', text: "'cause I need"}, 
  {start: '51.801', text: 'Little love and little sympathy'}, 
  {start: '55.731', text: 'Yeah you show me good loving'}, 
  {start: '58.091', text: 'Make it alright'}, 
  {start: '60.161', text: 'Need a little sweetness in my life'}, 
  {start: '63.591', text: 'Your sugar'}, 
  {start: '65.771', text: 'Yes, please'}, 
  {start: '67.801', text: "Won't you come and put it down on me"}, 
  {start: '72.591', text: 'My broken pieces'}, 
  {start: '74.611', text: 'You pick them up'}, 
  {start: '76.531', text: "Don't leave me hanging, hanging"}, 
  {start: '78.601', text: 'Come give me some'}, 
  {start: '80.561', text: "When I'm without ya"}, 
  {start: '82.531', text: "I'm so insecure"}, 
  {start: '84.601', text: 'You are the one thing'}, 
  {start: '85.921', text: "The one thing, I'm living for"}, 
  {start: '88.711', text: "I don't wanna be needing your love"}, 
  {start: '90.551', text: 'I just wanna be deep in your love'}, 
  {start: '92.581', text: "And it's killing me when you're away"}, 
  {start: '95.541', text: 'Ooh, baby,'}, 
  {start: '96.681', text: "'Cause I really don't care where you are"}, 
  {start: '98.551', text: 'I just wanna be there where you are'}, 
  {start: '100.51', text: 'And I gotta get one little taste'}, 
  {start: '103.61', text: 'Your sugar'}, 
  {start: '105.71', text: 'Yes, please'}, 
  {start: '107.71', text: "Won't you come and put it down on me"}, 
  {start: '111.11', text: "6]I'm right here,"}, 
  {start: '113.61', text: "'cause I need"}, 
  {start: '115.71', text: 'Little love and little sympathy'}, 
  {start: '119.71', text: 'Yeah you show me good loving'}, 
  {start: '120.051', text: 'Make it alright'}, 
  {start: '124.161', text: 'Need a little sweetness in my life'}, 
  {start: '127.731', text: 'Your Sugar!'}, 
  {start: '129.741', text: 'Yes, please'}, 
  {start: '131.831', text: "Won't you come and put it down on me"}, 
  {start: '135.831', text: 'Yeah'}, 
  {start: '136.581', text: 'I want that red velvet'}, 
  {start: '138.601', text: 'I want that sugar sweet'}, 
  {start: '140.591', text: "Don't let nobody touch it"}, 
  {start: '142.571', text: "Unless that somebody's me"}, 
  {start: '144.681', text: 'I gotta be a man'}, 
  {start: '146.531', text: "There ain't no other way"}, 
  {start: '148.451', text: "'Cause girl you're hotter than"}, 
  {start: '150.641', text: 'southern California day'}, 
  {start: '152.741', text: "I don't wanna play no games"}, 
  {start: '154.571', text: "I don't gotta be afraid"}, 
  {start: '156.521', text: "Don't give all that shy shit"}, 
  {start: '157.981', text: "No make up on, that's my"}, 
  {start: '160.081', text: 'Sugar'}, 
  {start: '161.721', text: 'Yes, please'}, 
  {start: '164.121', text: "Won't you come and put it down on me"}, 
  {start: '167.641', text: 'Oh, right here'}, 
  {start: '169.601', text: "'Cause I need"}, 
  {start: '171.991', text: 'Little love and little sympathy'}, 
  {start: '175.771', text: 'Yeah you show me good loving'}, 
  {start: '178.071', text: 'Make it alright'}, 
  {start: '180.081', text: 'Need a little sweetness in my life'}, 
  {start: '183.581', text: 'Your sugar!'}, 
  {start: '185.781', text: 'Yes, please'}, 
  {start: '187.801', text: "Won't you come and put it down on me"}, 
  {start: '191.721', text: 'Your sugar'}, 
  {start: '193.761', text: 'Yes, please'}, 
  {start: '195.601', text: "Won't you come and put it down on me"}, 
  {start: '199.551', text: "I'm right here, 'cause I need"}, 
  {start: '203.891', text: 'Little love and little sympathy'}, 
  {start: '207.611', text: 'Yeah you show me good loving'}, 
  {start: '210.071', text: 'Make it alright'}, 
  {start: '212.121', text: 'Need a little sweetness in my life'}, 
  {start: '215.691', text: 'Your sugar'}, 
  {start: '217.781', text: 'Yes, please'}, 
  {start: '219.861', text: "Won't you come and put it down on me"}
 
]
var textBurnItDown =    [
  {start:"00.37", text:"Burn It Down"},
  {start:"10.98", text:"Artist: LINKIN PARK"},
  {start:"43.25", text:"The cycle repeated"},
  {start:"47.71", text:"As explosions broke in the sky"},
  {start:"52.09", text:"All that I needed"},
  {start:"56.55", text:"Was the one thing I couldn't find"},
  {start:"60.89", text:"And you were there at the turn"},
  {start:"63.84", text:"Waiting to let me know"},
  {start:"69.52", text:"We're building it up"},
  {start:"73.00", text:"To break it back down"},
  {start:"78.26", text:"We're building it up"},
  {start:"82.63", text:"To burn it down"},
  {start:"84.36", text:"We can't wait"},
  {start:"85.90", text:"To burn it to the ground"},
  {start:"96.14", text:"The colors conflicted"},
  {start:"100.07",text:"As the flames climbed into the clouds"},
  {start:"104.59",text:"I wanted to fix this"},
  {start:"108.94",text:"But couldn't stop"},
  {start:"110.55",text:"From tearing it down"},
  {start:"113.20",text:"And you were caught at the turn"},
  {start:"116.57",text:"Caught in the burning glow"},
  {start:"122.11",text:"And I was there at the turn"},
  {start:"125.16",text:"Waiting to let you know"},
  {start:"130.69",text:"We're building it up"},
  {start:"135.04",text:"To break it back down"},
  {start:"139.36",text:"We're building it up"},
  {start:"143.73",text:"To burn it down"},
  {start:"145.44",text:"We can't wait"},
  {start:"147.07",text:"To burn it to the ground"},
  {start:"148.94",text:"You told me yes"},
  {start:"150.12",text:"You held me high"},
  {start:"151.18",text:"And I believed when you told that lie"},
  {start:"153.26",text:"I played that soldier"},
  {start:"154.46",text:"You played king"},
  {start:"155.53",text:"And struck me down"},
  {start:"156.53",text:"When I kissed that ring"},
  {start:"157.81",text:"You lost that right"},
  {start:"158.81",text:"To hold that crown"},
  {start:"159.87",text:"I built you up"},
  {start:"160.93",text:"But you let me down"},
  {start:"162.02",text:"So when you fall"},
  {start:"163.13",text:"I'll take my turn"},
  {start:"164.25",text:"And fan the flames"},
  {start:"165.16",text:"As your blazes burn"},
  {start:"165.98",text:"And you were there at the turn"},
  {start:"168.76",text:"Waiting to let me know"},
  {start:"174.26",text:"We're building it up"},
  {start:"178.66",text:"To break it back down"},
  {start:"183.00",text:"We're building it up"},
  {start:"187.36",text:"To burn it down"},
  {start:"189.01",text:"We can't wait"},
  {start:"190.62",text:"To burn it to the ground"},
  {start:"192.57",text:"When you fall"},
  {start:"193.79",text:"I'll take my turn"},
  {start:"194.77",text:"And fan the flames"},
  {start:"195.71",text:"As your blazes burn"},
  {start:"197.98",text:"We can't wait"},
  {start:"199.46",text:"To burn it to the ground"},
  {start:"201.59",text:"When you fall"},
  {start:"202.50",text:"I'll take my turn"},
  {start:"203.50",text:"And fan the flames"},
  {start:"204.43",text:"As your blazes burn"},
  {start:"206.60",text:"We can't wait"},
  {start:"208.10",text:"To burn it to the ground"},
  {start:"212.25",text:"End"},
]
var textBirds = [
  {start:"00.06",text:"Song: Birds"},
  {start:"02.66",text:"Singer: Imagine Dragons, Elisa"},
  {start:"17.02",text:"Two hearts, one valve"},
  {start:"20.85",text:"Pumpin' the blood, we were the flood"},
  {start:"24.07",text:"We were the body and"},
  {start:"24.95",text:"Two lives, one life"},
  {start:"28.88",text:"Stickin' it out, lettin' you down"},
  {start:"30.68",text:"Makin' it right"},
  {start:"32.38",text:"Seasons, they will change"},
  {start:"34.62",text:"Life will make you grow"},
  {start:"37.11",text:"Dreams will make you cry, cry, cry"},
  {start:"40.26",text:"Everything is temporary"},
  {start:"42.21",text:"Everything will slide"},
  {start:"44.24",text:"Love will never die, die, die"},
  {start:"47.90",text:"I know that ooh, birds fly in different directions"},
  {start:"56.59",text:"Ooh, I hope to see you again"},
  {start:"64.66",text:"Sunsets, sunrises"},
  {start:"68.07",text:"Livin' the dream, watchin' the leaves"},
  {start:"70.85",text:"Changin' the seasons"},
  {start:"72.61",text:"Some nights I think of you"},
  {start:"76.52",text:"Relivin' the past, wishin' it'd last"},
  {start:"78.92",text:"Wishin' and dreamin'"},
  {start:"80.49",text:"Seasons, they will change"},
  {start:"82.17",text:"Life will make you grow"},
  {start:"84.18",text:"Death can make you hard, hard, hard"},
  {start:"88.19",text:"Everything is temporary"},
  {start:"90.33",text:"Everything will slide"},
  {start:"92.55",text:"Love will never die, die, die"},
  {start:"95.96",text:"I know that ooh, birds fly in different directions"},
  {start:"104.60",text:" Ooh, I hope to see you again"},
  {start:"117.24",text:" Birds fly in different directions"},
  {start:"124.84",text:" So fly hight,So fly hight"},
  {start:"129.84",text:" When the moon is lookin' down"},
  {start:"137.84",text:" Shinin' light upon your ground"},
  {start:"146",text:" I'm flyin' up to let you see"},
  {start:"154.23",text:" That the shadow cast is me"},

]
var textWildLife = [{start:"1.123",text:"Đang cập nhập ^.^"}]
var textSomeday = [{start:"1.123",text:"Đang cập nhập ^.^"}]
var textDuskTillDawn = [{start:"1.123",text:"Đang cập nhập ^.^"}]
var textLeaveOutAllTheRest = [{start:"1.123",text:"Đang cập nhập ^.^"}]
var $ = document.querySelector.bind((document))

var isplaying = false
var isRamdom = false
var isrepeat = false
var current = 5

var start = $('.music-start')
var end = $('.music-end')
var audio = $('.audio')
var nameSong = $('.music-title')
var thumb = $('.music-image')
var inputPrecent = $('.range')
var timeStart = $('.music-start')
var timeduration = $('.music-end')
var inputVolume = $('.volume')
var iconMute = $('.music-volum .uil')
var lyrics = $('.lyrics')
//Btn
var playBtn = $('.btn-toggle')
var nextBtn = $('.btn-next')
var preBtn = $('.btn-pre')
var randomBtn = $('.btn-random')
var repeatBtn = $('.btn-repeat')
var unMuteBtn = $('.unmute')
var timeid = setInterval(displayTimer,1000)

// Xử lý quay đĩa nhạc
var cdthumb = thumb.animate([
  {transform: 'rotate(360deg)'}
],{
  duration:5000,
  iterations:Infinity
})
cdthumb.pause()
//lấy bài hát hiện tại
function getCurrentSong () {
  audio.src = songs[current].path
}
getCurrentSong()
//Thay đổi âm lượng
inputVolume.addEventListener('input',asd) 
function asd () {
  audio.volume = inputVolume.value
}
//tiến độ bài hát
var textSong = songs.map(function(element){  
  return element.textSong
});
audio.ontimeupdate = function() { 
  if(audio.duration) {
    var percent = Math.floor(audio.currentTime / audio.duration * 100)
    inputPrecent.value = percent
    timeCurrent = percent
  }
}
//Tua bài hát
inputPrecent.oninput = function () {
  var seek = audio.duration / 100 * inputPrecent.value
  audio.currentTime = seek
  displayTimer()
}
// render veiw
function render () {
  nameSong.innerHTML = songs[current].name
  thumb.src = songs[current].image
}
// render textSong
function createSubtitle()
{
    var element;
    for (var i = 0; i < textSong.length; i++) {
        element = document.createElement('p');
        element.innerText = textSong[i].text ;
        element.setAttribute('id',`c_${i}`)
        subtitles.appendChild(element);
    }
}
//play end pause
function playpause () {
  if(isplaying) {
    isplaying = false
    playBtn.classList.remove('playing')
    audio.pause()
    cdthumb.pause()
    lyrics.innerHTML= ''
  }else {
    isplaying = true
    playBtn.classList.add('playing')
    audio.play()
    cdthumb.play() 
    setInterval(displayTimer,1000) 
    lyrics.innerHTML= ''

  }
}
// Xử lý next bài
function nextSong () {
  if (isRamdom) {
    current = Math.floor(Math.random() * songs.length)
    getCurrentSong()
    render()
    isplaying = false
    playpause()
  }else {
    current++
    if (current >= songs.length) {
      current = 0
    }
    getCurrentSong()
    render()
    isplaying = false
    playpause()
  }
}
//Xử lý back bài
function preSong () {
  if (isRamdom) {
    current = Math.floor(Math.random() * songs.length)
    getCurrentSong()
    render()
    isplaying = false
    playpause()
  }else {
    current--
    if (current < 0) {
       current = songs.length - 1
    }
    getCurrentSong()
    render()
    isplaying = false
    playpause()
  }
}
// Xử lý khi hết bài
audio.onended = function () {

  if (isrepeat) {
    getCurrentSong()
    audio.play()
  }else {
    nextSong()
  }
}
// active Random 
function randomSong () {
  if (isRamdom) {
    isRamdom = false
    randomBtn.classList.remove('active')
  }else {
    isRamdom = true
    randomBtn.classList.add('active')
  }
}
// active repeat
function repeatSong () {
  if (isrepeat) {
    isrepeat = false
    repeatBtn.classList.remove('active')
  }else {
    isrepeat = true
    repeatBtn.classList.add('active')
  }
}
function displayTimer () {
  var { duration, currentTime} = audio
  start.textContent = formartTime(currentTime)
  if (duration) {
      end.textContent = formartTime(duration)
  }else {
    end.textContent = '00:00'
  }
}
displayTimer()
function formartTime (number) {
  var minutes = Math.floor(number / 60)
  var seconds = Math.floor(number - minutes * 60)
  return `0${minutes}:${seconds > 9 ? seconds: '0'+seconds}`
}
// even key
window.onkeydown = function (e) {
  console.log(e.which)
  switch(e.which) {
    case 80 :
      playpause()
      break
    case 39 :
      nextSong() 
      break
    case 37 :
      preSong()
      break
    case 76 :
      repeatSong()
      break
    case 82 :
      randomSong()
      break
    case 49 :  //1
      current = 0
      getCurrentSong()
      render()
      keyPlay()
      karaoke(textWildLife)
      break
    case 50 : //2
      current = 1
      getCurrentSong()
      render()
      keyPlay()
      karaoke(textSomeday)
      break
    case 51 : //3
      current = 2
      getCurrentSong()
      render()
      keyPlay()
      karaoke(textMaroon5)
      break
    case 52 : //4
      current = 3
      getCurrentSong()
      render()
      keyPlay()
      karaoke(textBirds)
      break
    case 53 : //5
      current = 4
      getCurrentSong()
      render()
      keyPlay()
      karaoke(textDuskTillDawn)
      break
    case 54 : //6
      current = 5
      getCurrentSong()
      render()
      keyPlay()
      karaoke(textBurnItDown)  
      break
    case 55 : //7
      current = 6
      getCurrentSong()
      render()
      keyPlay()
      karaoke(textLeaveOutAllTheRest)
      break
  } 
}
///keyPlay
function keyPlay () {
  isplaying =true
  audio.play()
  cdthumb.play()
  playBtn.classList.add('playing')
  lyrics.innerHTML =''
  lyrics.style.transform = `translateY(0px)`
}
repeatBtn.addEventListener('click',repeatSong)
randomBtn.addEventListener('click',randomSong)
playBtn.addEventListener('click',playpause)
nextBtn.addEventListener('click',nextSong)
preBtn.addEventListener('click',preSong)


 function karaoke(syncData) {    
      function createSubtitle()
      {
          var element;
          for (var i = 0; i < syncData.length; i++) {
              element = document.createElement('p');
              element.setAttribute("id", "c_" + i);
              element.innerText = syncData[i].text
              lyrics.appendChild(element);
          }
      }
  createSubtitle();


  audio.addEventListener("timeupdate", function(e){
  
      syncData.forEach(function(element, index){
          if( audio.currentTime >= element.start)
            {lyrics.children[index].classList.add('active')}
          if (lyrics.children[13].classList.contains('active')) {
            setTimeout(function(){
              lyrics.style.transform = `translateY(-580px)`
            },1000)     
          }
          if (lyrics.children[27].classList.contains('active')) {
            setTimeout(function(){
              lyrics.style.transform = `translateY(-1160px)`
            },1000) 
          }               
      });
  });
}

